@page "/weeklyReport"

@using HotelBookingSystem.Services
@inject MemoryStore Store

<h3>WeeklyReport</h3>

<table class="table">
    <thead>
    <tr>
        <th>Date</th>
        <th># Bookings</th>
        <th>With Special Request</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var day in GenerateReport())
    {
        <tr>
            <td>@day.Date</td>
            <td>@day.Count</td>
            <td>@day.WithRequest</td>
        </tr>
    }
    </tbody>
</table>

@code {
    public class DaySummary
    {
        public DateOnly Date { get; set; }
        public int Count { get; set; }
        public int WithRequest { get; set; }
    }

    private IEnumerable<DaySummary> GenerateReport()
    {
        var start = DateOnly.FromDateTime(DateTime.Today);
        return Enumerable.Range(0, 7).Select(i =>
        {
            var day = start.AddDays(i);
            var bookings = Store.Bookings.Where(b => day >= b.CheckIn && day < b.CheckOut);

            return new DaySummary
            {
                Date = day,
                Count = bookings.Count(),
                WithRequest = bookings.Count(b => !string.IsNullOrEmpty(b.SpecialRequest))
            };
        });
    }
}